# DNS
**–ö–ª–∏–µ–Ω—Ç DNS. –£—Ç–∏–ª–∏—Ç—ã.**    
```
# –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç bind-utils
$ yum install bind-utils
# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
$ dig www.otus.ru
$ host www.otus.ru
$ nslookup www.otus.ru
# –ü—Ä–∏–º–µ—Ä –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
$ dig MX www.otus.ru
$ dig TXT www.otus.ru
```

**–†–µ—Å—É—Ä—Å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (RR)**
- –ó–∞–ø–∏—Å–∏ DNS –æ–±–ª–∞–¥–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏:
  - –∏–º—è
  - TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –≤ –∫–µ—à–µ)
  - –∫–ª–∞—Å—Å
  - —Ç–∏–ø
  - –∑–Ω–∞—á–µ–Ω–∏–µ (–∏–ª–∏ –º–∞—Å—Å–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–π)


**–¢–∏–ø—ã –∑–∞–ø–∏—Å–µ–π**     
- A ‚Äî –∞–¥—Ä–µ—Å IPv4, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∏–º–µ–Ω–∏
- –ê–ê–ê–ê ‚Äî –∞–¥—Ä–µ—Å IPv6, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∏–º–µ–Ω–∏
- CNAME ‚Äî –∏–º—è, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –∏–º–µ–Ω–∏ (canonical name)
- MX ‚Äî –º–∞—Å—Å–∏–≤ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏ –∏–º—è) –ø–æ—á—Ç–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è –¥–æ–º–µ–Ω–∞
- TXT ‚Äî —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- SOA ‚Äî –∫–ª—é—á–µ–≤–∞—è –∑–∞–ø–∏—Å—å –¥–æ–º–µ–Ω–∞ (start of authority)
- NS ‚Äî –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞ –∏–º—ë–Ω –¥–ª—è –¥–æ–º–µ–Ω–∞ (nameserver)
- PTR ‚Äî –∏–º—è, —Å–æ–æ—Ç–≤–µ—Å—Ç–≤—É—é—â–µ–µ IP-–∞–¥—Ä–µ—Å—É (pointer –¥–ª—è in- addr.arpa –∏ ip6.arpa)
- SRV ‚Äî —É–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞


**PTR-–∑–∞–ø–∏—Å—å**    
- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π ‚Äú–æ–±—Ä–∞—Ç–Ω—É—é A-–∑–∞–ø–∏—Å—å‚Äù
- A-–∑–∞–ø–∏—Å—å –Ω—É–∂–Ω–∞ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–æ–º–µ–Ω–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –≤ IP-–∞–¥—Ä–µ—Å, PTR ‚Äî –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è IP-–∞–¥—Ä–µ—Å–∞ –≤ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è
- –í PTR-–∑–∞–ø–∏—Å–∏ IP-–∞–¥—Ä–µ—Å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. –¢–æ –µ—Å—Ç—å IP-–∞–¥—Ä–µ—Å 11.22.33.44 –≤ –æ–±—Ä–∞—Ç–Ω–æ–π –∑–æ–Ω–µ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω –∫–∞–∫ 44.33.22.11.
- –ó–∞—á–∞—Å—Ç—É—é –ø—Ä—è–º–∞—è –∏ –æ–±—Ä–∞—Ç–Ω–∞—è –∑–æ–Ω—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö DNS-—Å–µ—Ä–≤–µ—Ä–∞—Ö, —Ç–∞–∫ –∫–∞–∫ —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç —Ä–∞–∑–Ω—ã–º –∫–æ–º–ø–∞–Ω–∏—è–º (–¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –ø–æ–∫—É–ø–∞–µ—Ç –∫–æ–º–ø–∞–Ω–∏—è, –∞ IP–∞–¥—Ä–µ—Å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É)
- –ü—Ä–∏–º–µ—Ä:     
–û–±—Ä–∞—Ç–Ω–∞—è –∑–æ–Ω–∞: 10.168.192.in-addr.arpa     
–ó–∞–ø–∏—Å—å: 1 IN PTR www.otus.ru     
–†–µ–∑—É–ª—å—Ç–∞—Ç: 1.10.168.192.in-addr.arpa IN PTR www.otus.ru     

## DNS –°–µ—Ä–≤–µ—Ä

**–¢–∏–ø—ã —Å–µ—Ä–≤–µ—Ä–æ–≤**    
–¢–∏–ø—ã —Å–µ—Ä–≤–µ—Ä–æ–≤ (–ø–æ —Å–≤–æ–π—Å—Ç–≤–∞–º –∏ —Ñ—É–Ω–∫—Ü–∏—è–º):       
- –≥–ª–∞–≤–Ω—ã–µ (primary –∏–ª–∏ master) ‚Äî –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ, —Ö—Ä–∞–Ω—è—Ç –≥–ª–∞–≤–Ω—É—é –∫–æ–ø–∏—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–æ–Ω–µ;
- –≤—Ç–æ—Ä–∏—á–Ω—ã–µ (secondary –∏–ª–∏ slave) ‚Äî –ø–æ–ª—É—á–∞—é—Ç –∫–æ–ø–∏—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–æ–Ω–µ —Å –≥–ª–∞–≤–Ω–æ–≥–æ –∏–ª–∏ –≤—Ç–æ—Ä–∏—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–µ–π;
- –∫–µ—à–∏—Ä—É—é—â–∏–µ ‚Äî –∫–µ—à–∏—Ä—É—é—Ç –æ—Ç–≤–µ—Ç—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
- —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ ‚Äî –≤—ã–ø–æ–ª–Ω—è—é—Ç –ø–æ–ª–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏ DNS;
- –Ω–µ—Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ ‚Äî –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç –ø–æ–ª–Ω—ã–π –ø–æ–∏—Å–∫ (–Ω–µ —É–º–µ—é—Ç –∏–ª–∏ –∏–º –∑–∞–ø—Ä–µ—â–µ–Ω–æ)


**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**    
```
# –°—Ç–∞–≤–∏–º —Å–µ—Ä–≤–µ—Ä bind9
$ yum install bind
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
$ vim /etc/named.conf
# –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –∑–∞–¥–∞–µ–º —Ä–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∑–æ–Ω—ã
# –î–µ–ª–∞–µ–º —Ä–µ—Å—Ç–∞—Ä—Ç —Å–µ—Ä–≤–∏—Å–∞
$ systemctl restart named
# –î–æ–±–∞–≤–ª—è–µ–º –∞–¥—Ä–µ—Å —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –∏–º–µ–Ω –≤ /etc/resolv.conf
$ vim /etc/resolv.conf
nameserver 1.1.1.1
```

**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –∑–æ–Ω—ã –ø–æ–ª–Ω—ã–µ –∏–º–µ–Ω–∞**
```
$ cat /etc/named/zones/db.dns.lab
dns.lab. IN SOA ns01 .dns.lab. root.dns.lab. (
 2711201407 ; serial
 3600 ; refresh (1 hour)
 600 ; retry (10 minutes)
 86400 ; expire (1 day)
 600 ; minimum (10 minutes)
 )
 IN NS ns01 .dns.lab.
; DNS Servers
ns01.dns.lab. IN A 10.0.0.23
; Web
web1.dns.lab. IN A 10.0.0.23
web2.dns.lab. IN A 10.0.0.23
```


**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –∑–æ–Ω—ã - —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è**    
```
$ cat /etc/named/zones/db.dns.lab
$TTL 3600
; –æ–ø–∏—Å–∞–Ω–∏–µ –∑–æ–Ω—ã dns.lab.
$ORIGIN dns.lab.
@ IN SOA ns01.dns.lab. root.dns.lab. (
 2711201407 ; serial
 3600 ; refresh (1 hour)
 600 ; retry (10 minutes)
 86400 ; expire (1 day)
 600 ; minimum (10 minutes)
 )
 IN NS ns01.dns.lab.
; DNS Servers
ns01 IN A 10.0.0.23
; Web
web1 IN A 10.0.0.23
web2 IN A 10.0.0.23
```


**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –æ–±—Ä–∞—Ç–Ω–æ–π –∑–æ–Ω—ã**
```
# –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–π –∑–æ–Ω—ã 0.0.10.in-addr.arpa.
$ cat /etc/named/zones/db.0.0.10
$TTL 604800
@ IN SOA ns01.dns.lab. root.dns.lab. (
 20210806 ; Serial
 604800 ; Refresh
 86400 ; Retry
 2419200 ; Expire
 604800 ) ; Negative Cache TTL
;
; name servers
@ IN NS ns01.dns.lab.
; PTR Records
23 IN PTR ns01.dns.lab. ;10.0.0.23
24 IN PTR testptr.dns.lab. ;10.0.0.24
```
## Split DNS
Split DNS (—Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–π DNS) ‚Äî —ç—Ç–æ –º–µ—Ç–æ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –¥–æ–º–µ–Ω —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É –≤–Ω—É—Ç—Ä–∏ –∏ —Å–Ω–∞—Ä—É–∂–∏ —Å–µ—Ç–∏.     

–ì–æ–≤–æ—Ä—è –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:     
üî∏ –í–Ω—É—Ç—Ä–∏ —Å–µ—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP —Å–µ—Ä–≤–µ—Ä–∞.     
üî∏ –°–Ω–∞—Ä—É–∂–∏ —Å–µ—Ç–∏ ‚Äî –ø–æ–ª—É—á–∞—é—Ç –≤–Ω–µ—à–Ω–∏–π (–ø—É–±–ª–∏—á–Ω—ã–π) IP.     


**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?**     
1.–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–∞ –Ω–µ —Å–≤–µ—Ç—è—Ç—Å—è –Ω–∞—Ä—É–∂—É.     
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∏–¥—É—Ç –≤ –æ–±—Ö–æ–¥ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.     
3. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤ - –ú–æ–∂–Ω–æ —Ä–∞–∑–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –≤–Ω—É—Ç—Ä–∏ –∏ —Å–Ω–∞—Ä—É–∂–∏: –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–¥–∏–Ω –≤–µ–±-—Å–∞–π—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤, –¥—Ä—É–≥–æ–π ‚Äî –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.     

**–ö–∞–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è?**     
2 –≤–∞—Ä–∏–∞–Ω—Ç–∞:     

1. –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö DNS-—Å–µ—Ä–≤–µ—Ä–∞:
- –û–¥–∏–Ω –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤–Ω—É—Ç—Ä–∏ LAN
- –í—Ç–æ—Ä–æ–π ‚Äî –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ø—É–±–ª–∏—á–Ω—ã–π DNS)

2. –û–¥–∏–Ω DNS-—Å–µ—Ä–≤–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Split Horizon / Views:
- –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ BIND –∏–ª–∏ Unbound –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å "view" ‚Äî —Ä–∞–∑–Ω—ã–µ –∑–æ–Ω—ã DNS –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –∫—Ç–æ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å.
