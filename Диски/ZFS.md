# ZFS

ZFS (Zettabyte File System) — это продвинутая файловая система с управлением томами, разработанная компанией Sun Microsystems. Она обеспечивает высокую надёжность, защиту данных от повреждений, поддержку программных RAID (RAIDZ), мгновенные снимки (snapshots), сжатие данных и масштабируемость до эксабайтов информации.

ZFS совмещает в себе функции файловой системы и менеджера дисков, автоматически проверяя целостность данных и восстанавливая их в случае ошибок. Благодаря этим возможностям, ZFS широко используется в серверах хранения (NAS, SAN), виртуализации и резервном копировании.    

## Компоненты

<image src="https://github.com/LLlMEJIb87/LINUX/blob/main/%D0%94%D0%B8%D1%81%D0%BA%D0%B8/%D0%9A%D0%B0%D1%80%D1%82%D0%B8%D0%BD%D0%BA%D0%B8/zfs_komponenti.PNG">
</p>

__SPA Storage Pool Allocator__     
Пул устройств (pool) хранения данных - абстрактный уровень между логическими и физическими устройствами    

- Объединяет несколько физических устйроств в один логический объект
- Описывает размещение устройств
- отвечает за избыточность данных
- динамически расширяемый
- выступает в качестве хранилища данных

__DMU Data managment unit__
 DMU – это "мозг" ZFS. Отвечает за организацию, хранение и управление данными внутри файловой системы. Он работает как абстрактный слой между файловой системой и физическими блоками хранения.    

__Основные функции DMU__    
1. Управление структурой данных
- DMU хранит данные в виде объектов, а не обычных блоков.
- Каждый объект имеет уникальный идентификатор (object ID) и метаданные.
- Позволяет ZFS эффективно управлять снапшотами, квотами, ACL и сжатием.
2. Copy-on-Write (COW)
В отличие от традиционных файловых систем, ZFS не перезаписывает данные, а записывает изменения в новое место.Это предотвращает повреждение файлов при сбоях и делает возможными мгновенные снапшоты.
3. Использование транзакций
- Любая операция в ZFS (запись, удаление, изменение) оформляется как транзакция.Это гарантирует, что данные всегда остаются в консистентном (целостном) состоянии.
- Транзакции хранятся в Transaction Groups (TXG), которые периодически записываются на диск.
4. Сжатие и дедупликация
- DMU поддерживает LZ4, GZIP и ZSTD сжатие для экономии места.
- Также можно включить дедупликацию, чтобы не хранить дубликаты данных.
5. Проверка целостности данных
- DMU использует контрольные суммы для всех записанных данных.
- Если данные повреждены, ZFS может их восстановить (если есть зеркало или RAIDZ).
