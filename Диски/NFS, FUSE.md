# NFS
_ _ _

NFS (Network File System) — Клиент-серверный протокол доступа к файловым ресурсам. Способ поделиться файлами между компьютерами по сети так, как будто они находятся на одном локальном диске. 
## Версии
**NFSv3**    
- Асинхронная запись;
- Устойчивость к ошибкам;
- Работа с большими файлами (>2G);
- Stateless;
- Построен над RPC (Remote Procedure Call);
- Блокировки через NLM (lockd);
- Работает поверх TCP и UDP (port 2049.

**NFSv4**     
- Блокировки и управление общим доступом реализованы внутри основного демона NFS;
- Не требует rpcbind, lockd, rpc.statd;
- Поддержка локального кеша;
- Только TCP (port 2049) -> Statefull;
- Поддержка ACL (Access Control Lists);
- Расширенная аутентификациā (Kerberos).

## Демоны
**NFSv3: демоны**    
- rpc.nfsd - Основной демон сервера;
- rpc.mountd - обрабатывает запросы клиентов на монтирование каталогов;
- rpc.statd - (Network Status Monitor - NSM). Корректно снимает блокировку после сбоя/перезагрузки. Для уведомлениā о сбое исползует программу/usr/sbin/sm-notify;
- rpc.lockd - (NFS lock manager (NLM)) обрабатывает запросы на блокировку файлов. (В современных ядрах не нужен);
- rpc.idmapd - Длā NFSv4 на сервере преобразует локальные uid/gid полþзователей в формат вида имя@домен, а на клиенте обратно;
- rpc.rquotad - данные о квотах пользователя на сервере.

**NFSv4: дополнительные демоны**     
NFSv4 - авторизация    
- rpc.gssd - обеспечивает методы аутентификации через GSS-API (Kerberos-аутентификация). Работает на клиенте и сервере.
- rpc.svcgssd - обеспечивает проверку подлинности клиента на стороне сервера

## Монтирование
- /etc/exports - список директорий для экспорта
- /var/lib/nfs/xtab - список каталогов, примонтированных удаленными клиентами.
- /var/lib/nfs/etab - список каталогов, которые могут быть смонтированы удаленными системами с указанием всех параметров экспортированных каталогов.
- /var/lib/nfs/rmtab - rpc.mound регистрирует все успешные запросы на монтирование, при размонтировании записи удаляется
- /proc/fs/nfsd -     
❏ exports - список активных экспортированных иерархий и клиентов, которым их экспортировали, а также параметры.    
❏ threads - содержит число потоков (также можно изменять)     
❏ с помощью filehandle можно получить указатель на файл     
- /proc/net/rpc - содержит "сырую" (raw) статистику, которую можно получить с помощью nfsstat, а также различные кеши.
- /var/run/portmap_mapping - информация о зарегистрированных в RPC сервисах

**Опции монтирования**     
- nosuid - запрещает исполнять setuid программы из смонтированного каталога.
- noexec - запрещает исполнять программы из смонтированного каталога.
- tcp/udp
- nodev (no device - не устройство) - запрещает использовать в качестве устройств символьные и блочные специальные файлы.
- lock (nolock) - управление блокировкой
- rsize=n (read block size - размер блока чтениā) - Количество байтов, читаемых за один раз с NFS-сервера. Стандартно - 4096.
- wsize=n (write block size - размер блока записи) - Количество байтов, записываемых за один раз на NFS-сервер. Стандартно - 4096.
- nfsvers=(3|4)     

## Конфигурация сервера
Установка сервера
```
apt install nfs-kernel-server
```
Настройка сервера будет производиться в доманем задание (см.там)

# FUSE
FUSE (Filesystem in Userspace) — это технология, которая позволяет обычным пользователям (без root-прав) создавать и использовать свои файловые системы без изменений в ядре Linux.  

FUSE позволяет монтировать удалённые или нестандартные файловые системы (например, через облако, SSH, ZIP-архивы и т. д.) без сложных настроек.  

## Практическое применение
Самый частый и понятный пример использования FUSE — это SSHFS.     

Ты работаешь на своём локальном компьютере (Linux) и хочешь получить доступ к файлам на удалённом сервере по SSH. Конечно, можно использовать scp или rsync, но что если тебе удобнее работать с файлами как с обычной папкой?
С помощью одной команды мы можем «подключить» удалённый сервер как обычную папку:
```
sshfs user@remote_server:/path/to/folder /mnt/my_remote_folder
```
