# Логирование
_ _ _
**Задачи** **журналирования:**
- Фиксация событий системы и сервисов (syslog)
- Аудит — событий безопасности, инциденты (auth.log)
- Исходные данные для мониторинга после агрегации (access.log)
- Отладка проблем и поиск сбоев (error.log)
- Восстановление действий до указанного момента (binlog)
- Аналитика и поведение пользователей (access.log)
- Сценарий для нагрузочного тестированиā (access.log)

  ## Типы логов
Типы логов
1. Текстовые
- Прямой записи: /var/log/nginx/access.log
- Через rsyslogd: /var/log/syslog
2. Бинарные (через systemd-journald): /var/log/journal/
3. База данных (Elasticsearch, MySQL)

  ### Текстовые логи
```
cat syslog | grep err  - фильтрация логов
```
```
tail -n 10 syslog  - показать последние 10 строк
```
```
tail -f syslog - смотреть лог в реальном времени
```
```
head -n 10 syslog - показать первые 10 строк лога
```
__nano /etc/rsyslog.d/50-default.conf__ - конфигурационный файл в котором можно настроить сбор логов    

__/etc/logrotate.d__  в системе сущетсвует ротация логов, старые логи сохраняются и сжимаются, в этом файле находятся файлы с настройками для каждого сервиса.   

__Ротация логов:__
- Хранение истории
- Сжатие старых логов
- Конфигурация /etc/logrotate.conf, /etc/logrotate.d/*
- Часто настройки ротации создаётся при установке пакета
- Скрипт запуска: /etc/cron.daily/logrotat

  ### Journald
  Современная система логирования   
__/etc/systemd/journald.conf__ - конфигурационный файл journald

__journalctl -b__ - покажет сообщения с ммоента загрузки системы     
__journalctl -b | grep__  фильтруем по слову     
__journalctl --since "2024-10-15 00:00:00"__ - фильтруем по дате    
__journalctl --since "2024-10-15 00:00:00" --until "2024-10-15 08:00:00"__ - фильтруем от и до    
__journalctl - xeu nginx.service__ - посмотреть логи относящиеся к конкретному сервису   
__journalctl -p err -b__ - посмотреть только ошибки с момента последней загрузки    

## Централизованный сбор логов с помощью ELK
__Компоненты__
- **E**lasticsearch — база данных для надёжного хранения документов
- **L**ogstash — обработка данных из логов
- **K**ibana — визуализация данных из Elasticsearch (дашборды)
- Beats — агенты сбора данных для сохранения в ELK-стеке   
  Компоненты могут быть требовательными к оперативной памяти, полный стек — 4 GB минимум

  __Beats__
- Filebeat — основной поставщик данных в ELK
- Heartbeat — проверка сервисов
- Auditbeat — события auditd (безопасность)
- Metricbeat — метрики для мониторинга системы

 <p align="center">
<image src="https://github.com/LLlMEJIb87/LINUX/blob/main/%D0%9B%D0%BE%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/Picture/ELK_dvij.PNG">
</p>    

Beats - собирают логи и отправляют   
Logstah - обработка/преобразование логов
Elasticsearch - хранение логов
kibana - визуализация   

### Cеть
 <p align="center">
<image src="https://github.com/LLlMEJIb87/LINUX/blob/main/%D0%9B%D0%BE%D0%B3%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/Picture/ELK_network.PNG">
</p>    

