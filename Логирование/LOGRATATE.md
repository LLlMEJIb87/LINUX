### LOGROTATE
Logrotate - подсистема для автоматической ротации логов, с возможностью сжатия,удаления, перемещения и гибкой настройкой под каждый вид лог файлов     


Как правило, инструмент Logrotate установлен по умолчанию и базово настроен для обработки ротации логов всех установленных пакетов, включая rsyslog, обработчик системных логов по умолчанию     


__/etc/logrotate.d__  в системе сущетсвует ротация логов, старые логи сохраняются и сжимаются, в этом файле находятся файлы с настройками для каждого сервиса.   

__Ротация логов:__
- Хранение истории
- Сжатие старых логов
- Конфигурация /etc/logrotate.conf, /etc/logrotate.d/*
- Часто настройки ротации создаётся при установке пакета
- Скрипт запуска: /etc/cron.daily/logrotat




__Конфигурация Logrotate__
В Ubuntu информацию о конфигурации Logrotate обычно можно найти в двух местах:
- /etc/logrotate.conf: этот файл содержит стандартные параметры и настраивает ротацию для нескольких логов, которые не принадлежат никаким системным пакетам. Он также использует оператор include для извлечения конфигурации из любого файла в каталоге /etc/logrotate.d.
- /etc/logrotate.d/: этот каталог содержит конфигурацию Logrotate для всех устанавливаемых вами пакетов, которым требуется помощь в ротации логов. В стандартной установке там уже должны быть файлы для основных системных
инструментов, таких как apt, dpkg, rsyslog и так далее.


По умолчанию logrotate.conf настраивает еженедельную ротацию, при этом логи принадлежат пользователю root и группе syslog. Одновременно сохраняются четыре файла (rotate 4), а новые пустые логи создаются после ротации текущего лога (create).     

__Основные параметры конфигов logrotate__     

Частота проверки по условиям:
- hourly - каждый час
- daily - каждый день
- weekly - каждую неделю
- monthly - каждый месяц
- yearly - каждый год

__logrotate: условия__    
- rotate — указывает, сколько старых логов нужно хранить (в параметрах передаетсяколичество);
- create — создание пустого файла лога после перемещения старого;
- dateext — перед заголовком старого лога добавляется дата ротации;
- compress — сжатие логов;
- delaycompress — не сжимать последний и предпоследний журнал;
- extension — сохранять оригинальный лог-файл после ротации, если у него указанорасширение;
- mail — отправлять e-mail после завершения ротации;
- maxage — выполнять ротацию журналов, если они старше, чем указано;
- missingok — не выдавать ошибки, если лог-файла не существует;
- olddir — перемещать старые логи в отдельную папку;
- start — номер, с которого будет начинаться нумерация старых логов;
- size — размер лога, когда он будет перемещен.
- notifempty – не ротировать файл лога, если он пуст.
- copytruncate – обрезать оригинальный файл до нулевого размера после создания копии вместо переименования оригинального файла и создания нового
- postrotate/prerotate -> endscript – cтроки, находящиеся между данными служебными словами, каждое из которых должно находиться в отдельной строке, выполняются с использованием /bin/sh после ротации файла журнала. Параметр sharedscripts означает, что скрипт postrotate будет выполнятся только один раз, а не после обработки каждого файла.


__logrotate: пример конфигурации__    
```
[root@logs ~]# cat /etc/logrotate.d/nginx
/var/log/nginx/*.log {
daily
missingok
rotate 52
compress
delaycompress
notifempty
create 0640 www-data adm
sharedscripts
prerotate
if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
run-parts /etc/logrotate.d/httpd-prerotate; \
fi \
endscript
```
Проверка конкретного конфига logrotate без применения:
```
logrotate -d /etc/logrotate.d/chrony
```
Применение конкретного конфига logrotate с выводом сообщений в консоль:
```
logrotate -v /etc/logrotate.d/auth
```
Запуск всех конфигов logrotate:
```
logrotate -v /etc/logrotate.conf
```
