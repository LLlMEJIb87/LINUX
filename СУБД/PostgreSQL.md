# PostgreSQL
PostgreSQL - это объектно-релляционная система управления базами данных (ОРСУБД, ORDBMS), основанная на POSTGRES, Version 4.2 - программе, разработанной на факультете компьютерных наук Калифорнийского университета в Беркли.   

Благодаря свободной лицензии, PostgreSQL разрешается бесплатно использовать, изменять и распространять всем и для любых целей - личных, коммерческих или учебных.   

**Когда следует использовать PostgreSQL**
- Когда в приоритете надёжность и целостность данных
- Когда СУБД должна выполнять сложные процедуры (например, в случае реализации части бизнес-логики внутри СУБД)

**Когда НЕ следует использовать PostgreSQL**
- Когда не требуется повышенная надёжность, поддержка ACID и т д
- Когда от СУБД нужны только быстрые операции чтения


**ТЕРМИНЫ**   
**PostgreSQL** — это программа, которая относится к классу систем управления базами данных    
**Сервер** или **экземпляр** сервера - это программа PostgreSQL в процессе выполнения    
Данные, которыми управляет PostgreSQL, хранятся в **базах данных**   
**Кластер** - набор баз данных    
**Транзакция** - последовательность операций, которая сохраняет согласованность данных при условии, что операции выполнены полностью и без помех со стороны других транзакций

## Архитектура
Клиент - серверная.    

Транзакция выполняется либо полностью либо не выполняется вообще. В случае выполнение транзакции просихосдит commit, если что то пошло не так rollback


## Конфиги

> По умолчанию (после установки) postgresql конфиг postgres заточен под слабое железо и его нужно будет адаптирвоать под современные реалии


1. В debian дестрибутивах основной конфиг лежит по пути:    
/etc/postgresql/14/main/postgresql.conf

  
**Кастомизация:**      
- Существую сервисы калькуляторы такие как PGTune для расчета конфигруации БД в зависимости от мощностей сервера.
- Autovacuum


2. Конфиг, который ограничивает возможность подключений к нашему серверу базы данных
/etc/postgresql/14/main/pg_hba.conf    
Есть 2 типа подключения:
- локальное - коннект идет через unix socket ( когда конектимся с машины на которой он установлен)
- хостовое - через сетевой интерфейс ( подключение через localhost 127.0.0.1/32 является хостовым подключением)


**trust** - не проверять доступ    
**md5** - проверка по логину-паролю     
**peer** - сопоставление с пользователем системы (доступно только для локальных подключений)    

```
# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             all                                     trust
# IPv4 local connections:
host    all             all             127.0.0.1/32            scram-sha-256 - означает доступ по логину и паролю
```
### Пул соединений
В случае большого кол-ва соединейни - создается пул ( клиент, который подключется сверх лимита не отбрасывается, а ждет очереди)

<p align="center">
<image src="https://github.com/LLlMEJIb87/LINUX/blob/main/СУБД/Pictures/postgres_pool.PNG">
</p>

## Хранение данных

<p align="center">
<image src="https://github.com/LLlMEJIb87/LINUX/blob/main/СУБД/Pictures/postgres_hranenie.PNG">
</p>

ПО записывает данные не сразу на диск, какое-то время они находятся в общей оперативной памяти. Чтобы с лучае выходя системы из строя не потерялись данные существует журнал WAL ( сохраняет минимальную иформацию о транзакции)     

## Многоверсионность

В случае когда у нас одновременно работают много сессий, возможен вариант когда одновременно 2 или более транзакций одновременно обращаются к одной и той же строке (когда обе транзации на чтение - нет проблем, когда обе транзакции на запись - нет проблем, выстраиваются в очередь) читающая и пишущая, postgres хранит 2 версии одной и той же строки и каждая транзакция пишущая и читающая работает со своей версией


## Подключение и работа
```
root@tvip-tms:/etc/postgresql/14/main# su - postgres #переходим в пользователя posgres
postgres@tvip-tms:~$ psql #запускаем утилиту
postgres=# 
```
- \l - посоммтреть каие есть базы данных     
   \c tvip-tms - подключиться к опр. базе     
   \dt - посомтреть какие есть таблички в текущей базе данных     
- \du - посмотреть роли, пользователей
  create role dima login;
  \c - dima подключиться к роли dima 
 - \!pwd - если нужно выполнить linux(shell) команду не выхдя из postges
