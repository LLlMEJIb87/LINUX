# Загрузка OS
## UEFI
1. Нажатие кнопки питания: ПК включается, электричество подаётся на материнскую плату.
2. Запуск UEFI: Код UEFI, который хранится в чипе прошивки на материнской плате, начинает исполняться. Этот чип использует NVRAM как "записную книжку" с настройками.
3. Тест оборудования (POST): UEFI проверяет критические компоненты — процессор, память, диски и т.д. Если всё ок, идём дальше.
4. Поиск загрузчика: UEFI смотрит в NVRAM, где записано, какой файл загрузчика и на каком разделе искать (например, /EFI/ubuntu/grubx64.efi на EFI-партиции).
5. Запуск загрузчика: Если загрузчик найден, UEFI передаёт управление ему — запускается код GRUB (или другого загрузчика, если он настроен).
- UEFI читает файл загрузчика с диска (это бинарный файл в формате .efi) и загружает его в оперативную память компьютера.
- UEFI готовит минимальную информацию для загрузчика: сообщает, где находится оборудование (через таблицы ACPI), какие устройства доступны (диски, память) и как с ними работать. 
- UEFI выполняет команду "jump" (прыжок) в assembler-подобной логике. Это инструкция процессору: "Теперь начинай выполнять код, который лежит вот по этому адресу в памяти" (где загружен grubx64.efi).
- Как только процессор начинает выполнять код загрузчика, UEFI перестаёт быть активным. Теперь GRUB (или другой загрузчик) "рулит" — он инициализирует себя, читает свои конфиги (например, /boot/grub/grub.cfg) и продолжает процесс загрузки ядра.

## GRUB
1. Инициализация GRUB:
- Как только процессор "прыгает" на адрес в памяти, где лежит код GRUB (например, grubx64.efi для UEFI), загрузчик начинает исполняться.
- GRUB инициализирует себя: проверяет, в каком режиме он работает (UEFI или BIOS), определяет доступное оборудование через информацию, оставленную UEFI (например, таблицы памяти и устройств).
2. Чтение конфигурации:
- GRUB ищет свой конфигурационный файл, чтобы понять, что делать дальше. В Ubuntu это обычно /boot/grub/grub.cfg.
- Этот файл находится на диске (например, в корневом разделе или отдельном /boot), и GRUB использует встроенные драйверы файловых систем (ext4, FAT и т.д.), чтобы его прочитать.
- В grub.cfg прописаны команды: какое ядро загружать, какие параметры ему передать, и есть ли меню для выбора.
3. Отображение меню (если настроено):
- Если в настройках GRUB (в файле /etc/default/grub) указано показывать меню (например, GRUB_TIMEOUT=5), ты увидишь экран с выбором:
- Доступные ядра (например, Ubuntu, with Linux 5.15.0-73-generic).
- Режим восстановления (Recovery Mode).
- Другие ОС, если они есть (например, Windows).
- Если таймаут = 0 или меню отключено, GRUB сразу грузит вариант по умолчанию.
4. Поиск ядра и начального RAM-диска:
- GRUB читает из grub.cfg пути к файлам ядра (обычно /boot/vmlinuz-X.XX.X-XX-generic) и начального RAM-диска (/boot/initrd.img-X.XX.X-XX-generic).
- Эти файлы тоже лежат на диске, и GRUB загружает их в оперативную память, как UEFI делал с самим GRUB.
5. Копирование в память:
Ядро (vmlinuz) — это сжатый исполняемый файл, который GRUB распаковывает и размещает в определённой области RAM.
initrd (initial ramdisk) — это временная файловая система, тоже загружается в RAM. Она нужна ядру, чтобы найти драйверы для работы с диском и корневой файловой системой.
6. Передача параметров ядра:
- GRUB передаёт ядру командную строку (kernel command line), которая указана в grub.cfg. Например:
- root=UUID=xxxx-xxxx-xxxx — где искать корневой раздел.
- ro — монтировать корень только для чтения сначала.
- quiet splash — скрыть лишние сообщения и показать заставку (в Ubuntu Desktop).
7. Передача управления ядру:
- GRUB, как и UEFI до него, выполняет "прыжок" — указывает процессору адрес в памяти, где лежит распакованное ядро, и говорит: "Теперь ты главный".
- Технически это вызов точки входа ядра (entry point), например, функции start_kernel() в коде Linux.
8. GRUB отключается:
- После передачи управления GRUB завершает свою работу и больше не активен. Всё, что он сделал — это подготовил ядро и initrd в памяти и "нажал старт".
