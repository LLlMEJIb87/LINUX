# Пользователи и группы. Авторизацация и аутентификация.
__Бащовые понятия__   
 **AAA** 
- Authentication - аутентификация, идентификация, процесс подтверждения пользователем своей подлинности. Ввод логина и пароля.
- Authorization - авторизация, процесс наделения пользователя правами (предоставления доступа к каким-либо объектам)
- Accounting - запись информации о произошедших событиях    

- Условия для входа
   - shell должен существовать и быть перечисленным в /etc/shells
   - установлен пароль
- Блокировка пользователя:
   - установка shell в /bin/nologin
   - установка expiry date в прошлое
   - Блокировка паролы (делаем его непроверяемым, добавляя "!")
- Файл настроек для управления политиками при создании пользователей:     
/etc/login.defs



__Классическая аутентификация__     
1. /etc/passwd - список пользователей   
- Имя пользователя
- Цифровой идентификатор пользователя (UID)
- Цифровой идентификатор основной группы пользователя (GID)
- Полное имя пользователя
- Домашний каталог пользователя
- Оболочка входа в систему
2. /etc/group - группы пользователей
- Имя группы
- Пароль группы
- Цифровой идентификатор группы (GID)
- Список пользователей, входящих в эту группу, как в дополнительную
- Основная группа пользователя - в /etc/passwd
3. /etc/shadow - пароли пользователей
- Регистрационное имя
- Захэшифрованный пароль
- Дата последнего изменения пароля
- Минимальное число дней между изменениями пароля
- Максимальное число дней между изменениями пароля
- Количество дней до истечения срока действия пароля
- Количество дней по истечении срока действия пароля
- Срок действия учетной записи
- Зарезервированное поле, которое в настоящее время всегда пустое


**Типы пользователей в Linux**
1. Суперпользователь root (UID = 0)
- Home /root
- Пароль не всегда
- Есть shell
- Неограниченные полномочия
2. Обычный пользователь user (UID > 1000)
- Home /home/user
- Пароль установлен
- Есть shell
- Доступ в рамках домашней директории
3. Системный пользователь daemon (UID < 1000)
- Home Любая
- Паролā нет
- Нет shell
- Ограниченный доступ

__Управление пользователями__    
- useradd - создание пользователя
- adduser - создание пользователя (скрипт)
- usermod - изменение пользователя
- userdel - удаление пользователя
- passwd - изменение пароля
- chage - изменение свойств пароля
- groupadd - создание группы
- groupdel - удаление группы
- id - просмотр свойств пользователя

__Механизм sudo__    
- su — переключение пользователя
- sudo su — переключение на суперпользователя (root)
- sudo — выполнение команды с правами суперпользователя
- /etc/sudoers — конфигурация sudo

__Права доступа к файлам__   

<p align="center">
<image src="https://github.com/LLlMEJIb87/LINUX/blob/main/%D0%91%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C/Pictures/bits_dostup.PNG">
</p>    
  
 1. r - readable (чтение) - цифровое обозначение 4
- файл чтение файла   
- директория просмотр списка имен    
2. w - writeable (запись) - цифровое обозначение 2
- файл изменение файла    
- директория изменение объектов директории   
3. x - executeable (исполнение) - цифровое обозначение 1
- файл исполнение файла    
- директория доступ к inode в директории (вход, поиск)

 
-обычный файл    
l - символическая ссылка    
d - директория   
b - блочное устройтсво    
с - символьное устройство    
p - именнованный канал    
s - UNIX-сокет   

<p align="center">
<image src="https://github.com/LLlMEJIb87/LINUX/blob/main/%D0%91%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C/Pictures/spec_bits_dostup.PNG">
</p>        

https://www.gnu.org/software/coreutils/manual/html_node/Changing-Special-Mode-Bits.html    

__Расширенные атрибуты файлов___   

 Атрибуты
- a - файл может быть открыт только в режиме добавлениā
- A - не обновлять время перезаписи
- c - автоматически сжимать при записи на диск
- C - отключть копирование при записи
- i - сделать неизменяемым (даже для root)
- s - безопасное удаление с последующей перезаписью нулями    
```
 Изменение: chattr +i test_file
 Просмотр: lsattr
```

## Access Control List  

<p align="center">
<image src="https://github.com/LLlMEJIb87/LINUX/blob/main/%D0%91%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C/Pictures/ACL.PNG">
</p>      

- Повышение гибкости назначения прав доступа
- Поддержка на уровне файловой системы
- Может потребовать установки утилит
```
apt instal acl
```
- tune2fs -l /dev/mapper/ubuntu--vg-ubuntu--lv | grep acl
- setfacl -m u:zabbix:r test_file - установить ACL
- setfacl -m d:u:vagrant:rwx -R /usr/local/upload/ - установить дефолтные ACL (только для директорий)
- getfacl test_file - показать ACL
- setfacl -x u:zabbix FILE - убрать ACL

## Capabilitties
Механизм capability (возможности, полномочия) в Linux — это способ гранулировать права суперпользователя (root), чтобы процессам не нужно было иметь полный root-доступ, а только те привилегии, которые им реально нужны. Это повышает безопасность системы.   

__Что было раньше__    
До появления capability в Linux действовало простое правило:
- Если процесс UID = 0 (то есть root) → он может всё.
- Если не root → почти ничего из системных операций.
